## 记录一下折腾软路由入到坑。

### 0.本地环境和网络架构
运营商开通了动态公网IP。入户光猫是桥接模式。直连软路由，期待软路由做一些科学上网，DDNS，签到等工作。然后直连一个交换机（H3C的一个8口千兆交换机），把信号分到各个屋里，其中一根线走到无线路由器供家中无线设备连接。无线路由器是小米的AX3600，原生固件，设置成有线中继模式，也叫AP模式，只负责用来发射WiFi信号。
大概得网络拓扑类似这个图，网上找的图。
![277e30a1-f3d5-4279-a227-f76563afc0be](https://github.com/codechenz/Openwrt/assets/15170922/dcc106e2-daa1-4bac-9bb2-5d088883c57b)
光猫：天邑TEWA-600AGM
软路由：J1900的一个小机器
交换机：H3C 8口千兆
无线路由器：小米AX3600

### 1.选择软路由系统

首先是选择固件，市面上多数的都是基于Openwrt再开发的系统，因为自己比较小白，也不太想过于折腾，选择了iStoreOS这个固件作为软路由的系统。这个系统是国内一家公司做的，比较适合新手小白，很多设置都是自动生成的，也有一些三方软件可以安装，当然了必不可少的科学上网软件，都是支持的，我用的是OpenClash。还有其他好几种热门，可以满足大多数人的需求。

### 2.下载固件
选定了固件之后，就是去下载固件，当前更新的都是比较快的，一个月都能有好几个新版本。我的硬件是Intel的J1900，我用最新版（22.03.5-2023082509）的安装系统的时候总是遇到一些问题。后来改用了（21.02.3, 2022092414）就可以安装成功了。如果你也遇到类似的问题，可以选择一个旧一些的版本先安装上，之后再通过iStoreOS自己的在线升级固件，应该也可以。旧版本的系统大体的功能也都在，如果新版本没有你恰好想要的功能，旧版也是可以用的。下载连接的话 https://www.koolcenter.com/fw?firmware=iStoreOS&tag=default&version=default&arch=default&brand=default&alia=default 根据你CPU的架构选择相应的固件，我选择的是X86_64，至于有无EFI这个，较新的机型都是支持EFI的，这个我理解是一种启动方式。

### 3.刷入固件
#### a.U盘
大家常用的模式，刷固件的软件，Mac的话使用balenaEtcher， win的话用rufus。然后找一个大于4G的U盘，插入电脑，选择好刚才下载的固件，刷入即可。

#### b.直接刷入目标硬盘（建议）
如果你有硬盘转USB的转接口的话，就可以用这个方式。例如Sata转USB，这样你就可以把要刷入的硬盘，连接到电脑上。然后使用磁盘管理工具格式化磁盘。Mac可以用自带的磁盘工具，Win的话可以使用DiskGenius。将磁盘格式化，删除多余的分区，然后只创建一个分区，格式的话选择exFAT4,没记错的话。这个应该是Linux系统所需的格式。NFTS是windows，AFPS是macos的。然后还是使用balenaEtcher或者rufus，像往U盘刷系统一下，把系统刷到格式化好的盘中。rufus可能需要将.gz格式的解压成img或者iso格式。刷完之后，你的硬盘就已经成功安装了iStoreOS系统，把硬盘安装回软路由，然后上电开机。直接跳到第5步。

### 4.安装系统
使用U盘的需要这一步，
